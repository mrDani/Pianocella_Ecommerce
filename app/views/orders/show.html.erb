<!-- app/views/orders/new.html.erb -->

<h1 class="mb-4 text-center fw-bold">Confirm Your Order</h1>

<!-- Display the Cart Summary -->
<table class="table table-bordered table-striped mb-4">
  <thead>
    <tr>
      <th>Product</th>
      <th>Quantity</th>
      <th>Price</th>
      <th>Subtotal</th>
    </tr>
  </thead>
  <tbody>
    <% @cart_items.each do |item| %>
      <tr>
        <td><%= item[:product].name %></td>
        <td><%= item[:quantity] %></td>
        <td>$<%= number_with_precision(item[:product].price, precision: 2) %></td>
        <td>$<%= number_with_precision(item[:subtotal], precision: 2) %></td>
      </tr>
    <% end %>
    <tr>
      <td colspan="3" class="text-end"><strong>Total:</strong></td>
      <td><strong>$<%= number_with_precision(@total_price, precision: 2) %></strong></td>
    </tr>
  </tbody>
</table>

<%= form_with url: orders_path, method: :post, local: true do |f| %>
    <h2>Shipping Details</h2>
    
    <div class="mb-3">
      <%= f.label :address, "Address", class: "form-label" %>
      <%= f.text_field :address, value: current_user.address, class: "form-control", required: true %>
    </div>
  
    <div class="mb-3">
      <%= f.label :city, "City", class: "form-label" %>
      <%= f.text_field :city, value: current_user.city, class: "form-control", required: true %>
    </div>
  
    <div class="mb-3">
      <%= f.label :province, "Province", class: "form-label" %>
      <%= f.select :province, ["Alberta", "British Columbia", "Manitoba", "New Brunswick", "Newfoundland and Labrador", 
        "Northwest Territories", "Nova Scotia", "Nunavut", "Ontario", "Prince Edward Island", "Quebec", "Saskatchewan", "Yukon"], 
        { selected: current_user.province }, class: "form-select", required: true %>
    </div>
  
    <div class="mb-3">
      <%= f.label :postal_code, "Postal Code", class: "form-label" %>
      <%= f.text_field :postal_code, value: current_user.postal_code, class: "form-control", required: true %>
    </div>
  
    <div class="mb-3">
      <%= f.submit "Place Order", class: "btn btn-success" %>
    </div>
  <% end %>
  
