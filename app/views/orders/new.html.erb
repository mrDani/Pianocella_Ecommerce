<h1>Confirm Your Order</h1>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Product</th>
      <th>Qty</th>
      <th>Price</th>
      <th>Subtotal</th>
    </tr>
  </thead>
  <tbody>
    <% @cart_items.each do |item| %>
      <tr>
        <td><%= item[:product].name %></td>
        <td><%= item[:quantity] %></td>
        <td>$<%= number_with_precision(item[:product].price, precision: 2) %></td>
        <td>$<%= number_with_precision(item[:subtotal], precision: 2) %></td>
      </tr>
    <% end %>
    <tr>
      <td colspan="3" class="text-end"><strong>Total:</strong></td>
      <td><strong>$<%= number_with_precision(@total_price, precision: 2) %></strong></td>
    </tr>
  </tbody>
</table>

<%= form_with model: @order, url: orders_path, method: :post, local: true do |f| %>
  <div class="mb-3">
    <%= f.label :shipping_address, "Shipping Address", class: "form-label" %>
    <%= f.text_area :shipping_address, value: current_user.address, class: "form-control", rows: 2, required: true %>
  </div>

  <div class="mb-3">
    <%= f.label :city, "City", class: "form-label" %>
    <%= f.text_field :city, value: current_user.city, class: "form-control", required: true %>
  </div>

  <div class="mb-3">
    <%= f.label :province, "Province", class: "form-label" %>
    <%= f.select :province, [
      'Alberta', 'British Columbia', 'Manitoba', 'New Brunswick', 'Newfoundland and Labrador', 
      'Nova Scotia', 'Ontario', 'Prince Edward Island', 'Quebec', 'Saskatchewan', 
      'Northwest Territories', 'Nunavut', 'Yukon'
    ], { selected: current_user.province }, class: "form-select", required: true %>
  </div>

  <div class="mb-3">
    <%= f.label :postal_code, "Postal Code", class: "form-label" %>
    <%= f.text_field :postal_code, value: current_user.postal_code, class: "form-control", required: true %>
  </div>

  <div class="text-center">
    <%= f.submit "Place Order", class: "btn btn-success" %>
  </div>
<% end %>
